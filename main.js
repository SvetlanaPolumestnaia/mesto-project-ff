(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{k:()=>X});var t,r,o,n,c,i,a=document.querySelector(".places__list"),u=document.querySelector("#card-template").content,s=Array.from(document.querySelectorAll(".popup")),l=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_new-card"),p=document.querySelector(".popup_type_avatar"),f=document.querySelector(".profile__edit-button"),_=l.querySelector(".popup__button"),v=l.querySelector(".popup__close"),y=document.querySelector(".profile__add-button"),m=d.querySelector(".popup__button"),h=d.querySelector(".popup__close"),S=document.querySelector(".profile__image-edit"),b=p.querySelector(".popup__button"),k=p.querySelector(".popup__close"),q=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),C=q.querySelector(".popup__close"),g=l.querySelector(".popup__form"),x=l.querySelector(".popup__input_type_name"),w=l.querySelector(".popup__input_type_description"),U=document.querySelector(".profile__image"),A=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),I=d.querySelector(".popup__form"),T=I.querySelector(".popup__input_type_card-name"),B=I.querySelector(".popup__input_type_url"),D=p.querySelector(".popup__form"),M=p.querySelector(".popup__input_type_avatar"),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},P={myId:"f19ca1805b28867f6c3451ec",headers:{authorization:"a3a5f573-877f-4323-8cbf-b12cc816b747","Content-Type":"application/json"},baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",uriCards:"/cards",uriUsers:"/users",uriLikes:"/likes",uriMe:"/me",uriAvatar:"/avatar"};function N(e,t,r,o,n,c){var i=u.querySelector(".places__item").cloneNode(!0),a=i.querySelector(".card__image"),s=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),p=i.querySelector(".card__image");return a.src=e,s.textContent=t,a.alt=r,J(i,P),l.addEventListener("click",(function(e){o(e,P)})),d.addEventListener("click",(function(e){n(e,P)})),p.addEventListener("click",c),i}function J(e,t){var r=e.querySelector(".card__delete-button");e.dataset.ownerId===t.myId&&r.classList.add("card__delete-button_visible")}function H(e,t,r){var o=e.querySelector(".card__like-button");e.querySelector(".card__like-button_likes").textContent=t.likes.length,Array.from(t.likes).some((function(e){return e._id===r.myId}))?o.classList.add("card__like-button_is-active"):o.classList.remove("card__like-button_is-active")}function V(e){e.classList.add("popup_is-opened"),window.addEventListener("keydown",X)}function z(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keydown",X)}function G(e,t,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""}function F(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(r.inactiveButtonClass):t.classList.add(r.inactiveButtonClass)}function K(e,t){var r=e.querySelector(t.submitButtonSelector),o=e.querySelectorAll(t.inputSelector);r.classList.remove(t.inactiveButtonClass),o.forEach((function(r){G(e,r,t)}))}function Q(e,t){var r=e.target.closest(".places__item");if(r.dataset.ownerId===t.myId){r.remove();var o=t.baseUrl+t.uriCards+"/"+r.id;return fetch(o,{method:"DELETE",headers:t.headers}).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}}function R(e,t){var r=e.target.closest(".card__like-button"),o=r.closest(".places__item"),n=t.baseUrl+t.uriCards+t.uriLikes+"/"+o.id;return r.classList.contains("card__like-button_is-active")?fetch(n,{method:"DELETE",headers:t.headers}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при получении списка карточек с сервера:",error)})).then((function(e){H(o,e,t)})):fetch(n,{method:"PUT",headers:t.headers}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при получении списка карточек с сервера:",error)})).then((function(e){H(o,e,t),console.log(e)}))}function W(e){e.preventDefault(),E.src=e.target.src,L.textContent=e.target.alt,E.alt=e.target.alt,q.style.backgroundColor="rgba(0, 0, 0, .9)",V(q)}function X(e){"Escape"===e.key&&s.forEach((function(e){return z(e)}))}(t=P,r=t.baseUrl+t.uriUsers,o=fetch(r,{headers:t.headers}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при получении списка пользователей с сервера:",error)})),n=t.baseUrl+t.uriCards,c=[o,fetch(n,{headers:t.headers}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при получении списка карточек с сервера:",error)}))],Promise.all(c).then((function(e){return e})).catch((function(e){console.error("Ошибка при добавлении карточек с сервера:",e)}))).then((function(e){e[1].forEach((function(e){var t,r=N(e.link,e.name,e.name,Q,R,W);t=r,a.append(t),r.id=e._id,r.dataset.likes=e.likes.length,r.dataset.ownerId=e.owner._id,H(r,e,P),J(r,P)}))})),function(e){return fetch(e.baseUrl+e.uriUsers+e.uriMe,{method:"GET",headers:e.headers}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при получении данных профиля с сервера:",error)})).catch((function(e){console.error("Ошибка при отображении данных профиля:",e)}))}(P).then((function(e){A.textContent=e.name,j.textContent=e.about,U.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.error("Ошибка при добавлении данных профиля с сервера:",e)})),g.addEventListener("submit",(function(e){e.preventDefault(),_.textContent="Сохранение...",x.validity.valid&&w.validity.valid&&(function(e,t,r){fetch(r.baseUrl+r.uriUsers+r.uriMe,{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при изменении данных профиля на сервере:",error)})).catch((function(e){console.error("Ошибка при изменении данных профиля на сервере:",e)}))}(x.value,w.value,P),A.textContent=x.value,j.textContent=w.value),_.textContent="Сохранить"})),I.addEventListener("submit",(function(e){e.preventDefault(),m.textContent="Сохранение...",T.validity.valid&&B.validity.valid&&function(e,t,r,o,n,c){fetch(c.baseUrl+c.uriCards,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при добавлении данных на сервер:",error)})).then((function(i){var u=N(t,e,e,r,o,n);a.prepend(u),u.id=i._id,u.dataset.likes=i.likes.length,u.dataset.ownerId=i.owner._id,J(u,c),H(u,i,c)})).catch((function(e){console.error("Ошибка при создании карточки:",e)}))}(T.value,B.value,Q,R,W,P),m.textContent="Сохранить"})),D.addEventListener("submit",(function(e){e.preventDefault(),b.textContent="Сохранение...",M.validity.valid&&function(e,t){return fetch(t.baseUrl+t.uriUsers+t.uriMe+t.uriAvatar,{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(e){if(e.ok)return e.json();console.error("Ошибка при изменении аватара на сервере:",error)})).catch((function(e){console.error("Ошибка при изменении аватара на сервере:",e)}))}(M.value,P).then((function(e){U.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.error("Ошибка при изменении аватара:",e)})).finally((function(){b.textContent="Сохранить"}))})),s.forEach((function(e){e.classList.add("popup_is-animated")})),f.addEventListener("click",(function(){V(l),K(l,O),x.value=A.textContent,w.value=j.textContent})),y.addEventListener("click",(function(){V(d),K(d,O),I.reset()})),S.addEventListener("click",(function(){V(p),K(p,O),D.reset()})),v.addEventListener("click",(function(){z(l)})),h.addEventListener("click",(function(){z(d)})),k.addEventListener("click",(function(){z(p)})),C.addEventListener("click",(function(){z(q)})),_.addEventListener("click",(function(){z(l)})),m.addEventListener("click",(function(){z(d)})),b.addEventListener("click",(function(){z(p)})),s.forEach((function(e){e.addEventListener("click",(function(t){t.target===t.currentTarget&&z(e)}))})),i=O,Array.from(document.querySelectorAll(i.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);F(r,o,t),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?G(e,t,r):function(e,t,r,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)}(e,t,t.validationMessage,r)}(e,n,t),F(r,o,t)}))}))}(e,i)}))})();